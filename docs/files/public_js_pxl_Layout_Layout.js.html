<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>public\js\pxl\Layout\Layout.js - FastPixel doc</title>
    <link rel="stylesheet" href="http://yui.yahooapis.com/3.9.1/build/cssgrids/cssgrids-min.css">
    <link rel="stylesheet" href="../assets/vendor/prettify/prettify-min.css">
    <link rel="stylesheet" href="../assets/css/main.css" id="site_styles">
    <link rel="icon" href="../assets/favicon.ico">
    <script src="http://yui.yahooapis.com/combo?3.9.1/build/yui/yui-min.js"></script>
</head>
<body class="yui3-skin-sam">

<div id="doc">
    <div id="hd" class="yui3-g header">
        <div class="yui3-u-3-4">
                <h1><img src="../assets/css/logo.png" title="FastPixel doc" width="117" height="52"></h1>
        </div>
        <div class="yui3-u-1-4 version">
            <em>API Docs for: 1.0.0</em>
        </div>
    </div>
    <div id="bd" class="yui3-g">

        <div class="yui3-u-1-4">
            <div id="docs-sidebar" class="sidebar apidocs">
                <div id="api-list">
                    <h2 class="off-left">APIs</h2>
                    <div id="api-tabview" class="tabview">
                        <ul class="tabs">
                            <li><a href="#api-classes">Classes</a></li>
                            <li><a href="#api-modules">Modules</a></li>
                        </ul>
                
                        <div id="api-tabview-filter">
                            <input type="search" id="api-filter" placeholder="Type to filter APIs">
                        </div>
                
                        <div id="api-tabview-panel">
                            <ul id="api-classes" class="apis classes">
                                <li><a href="../classes/controller.html">controller</a></li>
                                <li><a href="../classes/history.html">history</a></li>
                                <li><a href="../classes/Layer.html">Layer</a></li>
                                <li><a href="../classes/Layout.html">Layout</a></li>
                                <li><a href="../classes/Observer.html">Observer</a></li>
                                <li><a href="../classes/Pixel.html">Pixel</a></li>
                                <li><a href="../classes/PrimitivePool.html">PrimitivePool</a></li>
                                <li><a href="../classes/pxl.html">pxl</a></li>
                                <li><a href="../classes/Vector2.html">Vector2</a></li>
                                <li><a href="../classes/View.html">View</a></li>
                            </ul>
                
                
                            <ul id="api-modules" class="apis modules">
                                <li><a href="../modules/pxl.html">pxl</a></li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div class="yui3-u-3-4">
                <div id="api-options">
                    Show:
                    <label for="api-show-inherited">
                        <input type="checkbox" id="api-show-inherited" checked>
                        Inherited
                    </label>
            
                    <label for="api-show-protected">
                        <input type="checkbox" id="api-show-protected">
                        Protected
                    </label>
            
                    <label for="api-show-private">
                        <input type="checkbox" id="api-show-private">
                        Private
                    </label>
                    <label for="api-show-deprecated">
                        <input type="checkbox" id="api-show-deprecated">
                        Deprecated
                    </label>
            
                </div>
            
            <div class="apidocs">
                <div id="docs-main">
                    <div class="content">
<h1 class="file-heading">File: public\js\pxl\Layout\Layout.js</h1>

<div class="file">
    <pre class="code prettyprint linenums">
(function(){
	&quot;use strict&quot;;

	/**
	 * pxl.Layout
	 * Call with width and height parameters
	 * or with already existing ImageData as source
	 *
	 * @constructor
	 * @class Layout
	 * @param ImageData {Object} [in]
	 * @param width {Number}
	 * @param height {Number}
	 */
	var Layout = pxl.Layout = function(){
		/**
		 * @property _imageData
		 * @private
		 * @type {ImageData}
		 */
		this._imageData = pxl.createImageData.apply(null, arguments);

		/**
		 * @property dataLayer
		 * @type {Layer}
		 */
		this.dataLayer = new pxl.Layout.Layer({
			&quot;source&quot;: this._imageData.data.buffer, &quot;layout&quot;: this
		});

		/**
		 * @property layerList
		 * @type {Array}
		 */
		this.layerList = [];

		/**
		 * @property activeLayer
		 * @type {Layer}
		 */
		this.activeLayer = null;

		/**
		 * @property observer
		 * @type {Observer}
		 */
		this.observer = new pxl.Observer;
	};

	var layoutProto = Layout.prototype;

	/**
	 * Append new Layer instance (if possible).
	 *
	 * @method appendLayer
	 * @chainable
	 */
	layoutProto.appendLayer = function(){
		if (this.layerList.length &lt; pxl.MAX_LAYER_COUNT){
			this.activeLayer = new Layout.Layer({
				&quot;source&quot;: this.getWidth() * this.getHeight(),
				&quot;layout&quot;: this,
				&quot;name&quot;: &quot;Layer &quot; + this.layerList.length
			});
			this.layerList.push(this.activeLayer);
		}
		return this;
	};

	/**
	 * Delete active layer (if has at least one).
	 *
	 * @method deleteLayer
	 * @chainable
	 */
	layoutProto.deleteLayer = function(){
		var layerList = this.layerList;
		if (layerList.length === 1){
			layerList[0].reset(); //don&#x27;t delete the last one
		} else{
			for (var i = 0; i &lt; layerList.length; ++i){
				if (layerList[i] === this.activeLayer){
					layerList.splice(i, 1);
					this.activeLayer = layerList[layerList.length - 1]; //top layer become active
					break;
				}
			}
		}
		return this;
	};

	/**
	 * Each visible layer &quot;drawn&quot; to main dataLayer layer (Back-to-front);
	 * Notify subscribers.
	 *
	 * @param options {Object} [in]
	 * @method mergeLayers
	 * @chainable
	 */
	layoutProto.mergeLayers = function(options){
		options = options || {};
		var clonedOpts = Object.create(options);
		var visibleLayers = this._visibleLayers();
		var layerCount = visibleLayers.length;
		var dataLayer = this.dataLayer;
		if (!layerCount){
			dataLayer.reset();
		} else{
			if ((options.start &amp;&amp; options.offset) || options.indexes){
				clonedOpts.other = visibleLayers[0];
				clonedOpts.isMix = false;
				dataLayer.merge(clonedOpts); //copy bottom layer
				clonedOpts.isMix = !!options.isMix;
			} else{
				dataLayer.copy(visibleLayers[0]); //much faster
			}
			for (var i = 1; i &lt; layerCount; ++i){
				clonedOpts.other = visibleLayers[i];
				dataLayer.merge(clonedOpts); //mix other layers
			}
		}
		this.observer.notify(pxl.PIXELS_CHANGED_EVENT, options);
		return this;
	};

    /**
     * Replace old color by new one in an active layer.
	 *
	 * @method colorReplace
	 * @param options {Object} [in]
	 * @chainable
     */
	layoutProto.colorReplace = function(options){
		this.activeLayer.colorReplace(options);
		this.mergeLayers(options);
		return this;
	};

    /**
     * Plot pixel or group of pixels onto active layer.
	 *
	 * @method plot
	 * @param options {Object} [in]
	 * @chainable
     */
	layoutProto.plot = function(options){
		this.activeLayer.plot(options);
		this.mergeLayers(options);
		return this;
	};

    /**
     * Flood fill on an active layer.
	 *
	 * @method fill
	 * @param options {Object} [in]
	 * @chainable
     */
    layoutProto.fill = function(options){
		if (this.activeLayer.fill(options)){
			this.mergeLayers();
		}
		return this;
    };

	/**
	 * @method indexesAt
	 * @param options {Object} [in]
	 * @param options.start {Vector2}
	 * @param options.offset {Vector2}
	 * @return {Array} warn: static array(read-only)
	 */
	layoutProto.indexesAt = (function(){ //anonymous
		var _container = [0];
		return function(options){
			var rContainer = _container; //store reference in current scope
			var start = options.start;
			var x = Math.max(0, options.start.x);
			var y = Math.max(0, options.start.y);
			var width = Math.min(this.getWidth() - 1, options.offset.x);
			var length = width * Math.min(this.getHeight() - 1, options.offset.y);
			var posWrapper = new pxl.Vector2;
			var indexOffset = 0;
			var index = this.indexAt(start);
			rContainer.length = length;
			for (var i = 0; i &lt; length; ++i){
				rContainer[i] = index + indexOffset; //take an index relative to coordinates
				if (++indexOffset &gt;= width){
					indexOffset = 0;
					index = this.indexAt(posWrapper.set(x, ++y));
				}
			}
			return rContainer;
		}
	})();

	/**
	 * Provide an index from position
	 * @method indexAt
	 * @param position {Vector2} [in]
	 * @return {Number}
	 */
	layoutProto.indexAt = function(position){
		return position.x + position.y * this.getWidth();
	};

	/**
	 * Provide position according to index
	 * @method positionFrom
	 * @param index {Number} [in]
	 * @return {Vector2}
	 */
	layoutProto.positionFrom = function(index){
		var width = this.getWidth();
		return new pxl.Vector2(index % width, (index / width) | 0);
	};

	/**
	 * @method getImageData
	 * @return {ImageData}
	 */
	layoutProto.getImageData = function(){
		return this._imageData;
	};

	/**
	 * @method getWidth
	 * @return {Number}
	 */
	layoutProto.getWidth = function(){
		return this._imageData.width;
	};

	/**
	 * @method getHeight
	 * @return {Number}
	 */
	layoutProto.getHeight = function(){
		return this._imageData.height;
	};

	/**
	 * @method _visibleLayers
	 * @private
	 * @return {Array}
	 */
	layoutProto._visibleLayers = function(){
		var visibleLayers = [];
		var layerList = this.layerList;
		for (var i = 0; i &lt; layerList.length; ++i){
			if (layerList[i].isVisible){
				visibleLayers.push(layerList[i]);
			}
		}
		return visibleLayers;
	};

	/**
	 * @destructor
	 * @method destroy
	 */
	layoutProto.destroy = function(){
		this.dataLayer.destroy();
		this.activeLayer = null;
		for (var i = 0; i &lt; this.layerList.length; ++i){
			this.layerList[i].destroy();
			this.layerList[i] = null;
		}
		Layout.history.clean();
	};
})();
    </pre>
</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<script src="../assets/vendor/prettify/prettify-min.js"></script>
<script>prettyPrint();</script>
<script src="../assets/js/yui-prettify.js"></script>
<script src="../assets/../api.js"></script>
<script src="../assets/js/api-filter.js"></script>
<script src="../assets/js/api-list.js"></script>
<script src="../assets/js/api-search.js"></script>
<script src="../assets/js/apidocs.js"></script>
</body>
</html>
