var pxl=function(t){"use strict";function i(t,i){"imageSmoothingEnabled"in t?t.imageSmoothingEnabled=i:"webkitImageSmoothingEnabled"in t?t.webkitImageSmoothingEnabled=i:"mozImageSmoothingEnabled"in t?t.mozImageSmoothingEnabled=i:"msImageSmoothingEnabled"in t&&(t.msImageSmoothingEnabled=i)}var e=void 0,n=!0,s=null,r={},a=null,o=null;try{if(Object.seal(r),a=t.createElement("CANVAS"),a.width=a.height=1,o=a.getContext("2d"),s=Object.getPrototypeOf(o.getImageData(0,0,1,1).data).constructor,s!==Uint8ClampedArray&&s!==Uint8Array)throw new Error;if(!(new s).buffer)throw new Error;e=2712847316===new Uint32Array(new Uint8Array([161,178,195,212]).buffer)[0]}catch(h){n=!1}var u={Layout:null,RGBA:null,View:null,Point:null,Observer:null,bresenham:null,controller:null,emptyOptions:r,ImageDataArray:s,isSupported:function(){return n},isBigEndian:function(){return e},createImageData:function(){return o.createImageData.apply(o,arguments)},clamp:function(t,i,e){return t>e?e:i>t?i:t},createCanvas:function(){return a.cloneNode()},imageDataFromImage:function(t){var i=null;return a.width=t.width,a.height=t.height,o.drawImage(t,0,0),i=o.getImageData(0,0,a.width,a.height),a.width=a.height=1,i},enableAntialiasing:function(t){i(t,!0)},disableAntialiasing:function(t){i(t,!1)},extend:function(t,i){var e=function(){};e.prototype=i.prototype,t.prototype=new e,t.prototype.constructor=t}};return Object.seal(u),u}(document);!function(t){"use strict";function i(t){var i=0|t;return i!==t&&0>i?--i:i}function e(t){return t+.5|0}function n(t){var i=0|t;return t===i?t:i+1}function s(t){return 0>t||t===-0?-t:t}if(t){var r=t.Point=function(t,i){this.set(t||0,i),Object.seal(this)};r.EPSILON=1e-10;var a=r.prototype;a.toString=function(){return'{"x":'+this.x+',"y":'+this.y+"}"},a.add=function(t,i){return t instanceof r?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+="number"==typeof i?i:t),this},a.sub=function(t,i){return t instanceof r?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-="number"==typeof i?i:t),this},a.mul=function(t,i){return t instanceof r?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*="number"==typeof i?i:t),this},a.div=function(t,i){return t instanceof r?(this.x/=t.x,this.y/=t.y):(this.x/=t,this.y/="number"==typeof i?i:t),this},a.set=function(t,i){return t instanceof r?(this.x=t.x,this.y=t.y):(this.x=t,this.y="number"==typeof i?i:t),this},a.cmp=function(t,i){return t instanceof r?s(this.x-t.x)<r.EPSILON&&s(this.y-t.y)<r.EPSILON:s(this.x-t)<r.EPSILON&&s(this.y-("number"==typeof i?i:t))<r.EPSILON},a.abs=function(){return this.x=s(this.x),this.y=s(this.y),this},a.neg=function(){return this.x=-s(this.x),this.y=-s(this.y),this},a.swap=function(t){var i=t.x;return t.x=this.x,this.x=i,i=t.y,t.y=this.y,this.y=i,this},a.floor=function(){return this.x=i(this.x),this.y=i(this.y),this},a.ceil=function(){return this.x=n(this.x),this.y=n(this.y),this},a.round=function(){return this.x=e(this.x),this.y=e(this.y),this},a.hasNaN=function(){return isNaN(this.x)||isNaN(this.y)},a.hasInfinity=function(){return!isFinite(this.x)||!isFinite(this.y)},a.clone=function(){return new r(this)}}}(pxl),function(t){"use strict";if(t){var i="'method' is not a function!",e=t.Observer=function(){this._eventBook={},Object.seal(this)},n=e.prototype;n.subscribe=function(t,e){if(!(e instanceof Function))throw new Error(i);if(t in this._eventBook){var n=this._eventBook[t];-1===n.indexOf(e)&&n.push(e)}else this._eventBook[t]=[e]},n.unsubscribe=function(t,e){if(!(e instanceof Function))throw new Error(i);if(t in this._eventBook){var n=this._eventBook[t],s=n.indexOf(e);-1!==s&&(n.splice(s,1),0===n.length&&delete this._eventBook[t])}},n.notify=function(t,i){if(t in this._eventBook)for(var e=this._eventBook[t],n=0;n<e.length;++n)e[n](i)}}}(pxl),function(t){"use strict";if(t){var i=t.bresenham={line:function(t,i,e,n,s){var r=e-t;0>r&&(r=-r);var a=n-i;a>=0&&(a=-a);for(var o=e>t?1:-1,h=n>i?1:-1,u=r+a,l=0;s(t,i),t!==e||i!==n;)l=u<<1,l>=a&&(u+=a,t+=o),r>=l&&(u+=r,i+=h)},rectangle:function(t,e,n,s,r){var a=0;t===n||e===s?t===n&&e===s?r(t,e):i.line(t,e,n,e,r):(t>n&&(a=t,t=n,n=a),e>s&&(a=e,e=s,s=a),i.line(t,e,n-1,e,r),i.line(n,e,n,s-1,r),i.line(n,s,t+1,s,r),i.line(t,s,t,e+1,r))},ellipse:function(t,i,e,n,s){var r=e-t,a=r*r;0>r&&(r=-r);var o=n-i,h=o*o;0>o&&(o=-o);var u=1&o,l=(1-r)*h<<2,c=(1+u)*a<<2,f=l+c+u*a,y=0;t>e&&(t=e,e+=r),i>n&&(i=n),i+=o+1>>1,n=i-u,r=a<<3,u=h<<3;do s(e,i),s(t,i),s(t,n),s(e,n),y=f<<1,c>=y&&(++i,--n,f+=c+=r),(y>=l||f<<1>c)&&(++t,--e,f+=l+=u);while(e>=t);for(;o>=i-n;)s(t-1,i),s(e+1,i++),s(t-1,n),s(e+1,n--)}};Object.freeze(i)}}(pxl),function(t,i){"use strict";function e(t){return(255&t)>>>0}function n(t){return(65280&t)>>>8}function s(t){return(16711680&t)>>>16}function r(t){return(4278190080&t)>>>24}var a=null,o=null,h=null,u=null,l=null;t&&i.constructor===Boolean&&(i?(a=t.RGBA=function(t,i,e,n){return(n|e<<8|i<<16|t<<24)>>>0},o=a.getR=r,h=a.getG=s,u=a.getB=n,l=a.getA=e):(a=t.RGBA=function(t,i,e,n){return(t|i<<8|e<<16|n<<24)>>>0},o=a.getR=e,h=a.getG=n,u=a.getB=s,l=a.getA=r),a.alphaBlend=function(t,i){var e=l(i),n=(255-e)*l(t)+127,s=(e<<8)+n>>8;return n>>=8,a((e*o(i)+n*o(t)+127)/s|0,(e*h(i)+n*h(t)+127)/s|0,(e*u(i)+n*u(t)+127)/s|0,s)},Object.freeze(a))}(pxl,pxl.isBigEndian()),function(){"use strict";function t(t){t._buffer=t._layout=null}function i(t,i){return i*(1-t)>>1}var e=pxl.View=function(t,i,e,n){this._buffer=i,this._ctx=t,this._layoutOwner=Boolean(n),this._imagePoint=new pxl.Point,this._scale=1,this._layout=e,this._boundedRender=null,this._subscribe(),Object.seal(this)};e.create=function(t){var i=null,n=null,s=null,r=!0,a=null,o=null,h=null;return i="CANVAS"===t.element.nodeName.toUpperCase()?t.element:t.element.appendChild(pxl.createCanvas()),t.source?(n=t.source._buffer.canvas,s=t.source._layout,r=!1):(n=pxl.createCanvas(),n.width=t.layoutSize.width,n.height=t.layoutSize.height,s=new pxl.Layout(n.width,n.height)),o=i.getContext("2d"),h=n.getContext("2d"),pxl.disableAntialiasing(o),pxl.disableAntialiasing(h),a=new e(o,h,s,r),e.instances.push(a),a},e.instances=[],e.activeView=null;var n=e.prototype;n.render=function(t){return this.clear(t).update(t).redraw(t)},n.drawRect=function(t){var i=t.pixel,e=pxl.RGBA;return this._ctx.fillStyle="rgba("+e.getR(i)+","+e.getG(i)+","+e.getB(i)+","+e.getA(i)/255+")",this._ctx.fillRect(t.start.x+this._imagePoint.x,t.start.y+this._imagePoint.y,t.offset.x,t.offset.y),this},n.redraw=function(t){return t.start&&t.offset?this._ctx.drawImage(this._buffer.canvas,t.start.x,t.start.y,t.offset.x,t.offset.y,t.start.x+this._imagePoint.x,t.start.y+this._imagePoint.y,t.offset.x,t.offset.y):this._ctx.drawImage(this._buffer.canvas,this._imagePoint.x,this._imagePoint.y),this},n.clear=function(t){return t.start&&t.offset?this._ctx.clearRect(t.start.x+this._imagePoint.x,t.start.y+this._imagePoint.y,t.offset.x,t.offset.y):this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this},n.update=function(t){return this._layoutOwner&&(t.start&&t.offset?this._buffer.putImageData(this._layout.getImageData(t),t.start.x,t.start.y,0,0,t.offset.x,t.offset.y):this._buffer.putImageData(this._layout.getImageData(t),0,0)),this},n.begin=function(){var t=this._scale,e=this._ctx;return e.save(),e.translate(i(t,this._layout.getWidth()),i(t,this._layout.getHeight())),e.scale(t,t),this},n.end=function(){return this._ctx.restore(),this},n.getBufferContext=function(){return this._buffer},n.getScale=function(){return this._scale},n.getElement=function(){return this._ctx.canvas},n.getLayout=function(){return this._layout},n.getImagePoint=function(){return new pxl.Point(this._imagePoint)},n.getScaleOffset=function(){return new pxl.Point(i(this._scale,this._layout.getWidth()),i(this._scale,this._layout.getHeight())).abs().div(this._scale)},n.setScale=function(t){return t>=1&&(this._scale=0|t),this},n.setLayout=function(t){var i=e.instances;this.deleteLayout(),this._layout=t,this._subscribe(),this._layoutOwner=!0;for(var n=0;n<i.length;++n)if(i[n]!==this&&t===i[n]._layout){this._layoutOwner=!1;break}return this},n.setImagePoint=function(t,i){return this._imagePoint.set(t,i)},n.setAlpha=function(t){return this._ctx.globalAlpha=t,this},n.resizeElement=function(t,i){return this._ctx.canvas.style.width=t+"px",this._ctx.canvas.style.height=i+"px",this._ctx.canvas.width=t,this._ctx.canvas.height=i,pxl.disableAntialiasing(this._ctx),this},n.deleteLayout=function(){var i=e.instances;if(this._unsubscribe(),this._layoutOwner){for(var n=0;n<i.length;++n)this!==i[n]&&this._layout===i[n]._layout&&(i[n]._unsubscribe(),t(i[n]));this._layout.destroy(),t(this)}return this},n._subscribe=function(){if(null!==this._boundedRender)throw new Error("View instance is already subscribed!");return this._boundedRender=this.render.bind(this),this._layout.observer.subscribe(pxl.Layout.PIXELS_CHANGED_EVENT,this._boundedRender),this},n._unsubscribe=function(){return this._layout.observer.unsubscribe(pxl.Layout.PIXELS_CHANGED_EVENT,this._boundedRender),this._boundedRender=null,this},n.destroy=function(){var t=e.instances;this.deleteLayout();for(var i=0;i<t.length;++i)if(this===t[i]){t.splice(i,1);break}}}(),function(){"use strict";function t(t){for(var i=[],e=0;e<t.length;++e)t[e].isVisible===!0&&i.push(t[e]);return i}var i=pxl.Layout=function(){this._imageData=pxl.createImageData.apply(null,arguments),this.dataLayer=new pxl.Layout.Layer(this._imageData.data.buffer,this),this.layerList=[],this.activeLayer=null,this.observer=new pxl.Observer,Object.seal(this)};i.PIXELS_CHANGED_EVENT="pixelsChanged";var e=i.prototype;e.insertLayer=function(t){function e(t){return new i.Layer(t.getWidth()*t.getHeight(),t)}var n=null;return arguments.length?t>=0&&t<=this.layerList.length&&(n=e(this),this.layerList.splice(t,0,n)):(n=e(this),this.layerList.push(n)),n},e.setActiveTo=function(t){return t>=0&&t<this.layerList.length&&(this.activeLayer=this.layerList[t]),this},e.removeAllLayers=function(){for(this.activeLayer=null;this.layerList.length;)this.layerList.pop().destroy();return this},e.deleteLayer=function(){for(var t=this.layerList,i=0;i<t.length;++i)if(t[i]===this.activeLayer){t.splice(i,1),this.activeLayer.destroy(),this.activeLayer=null;break}return this},e.mergeLayers=function(e,n){var s={},r=t(n||this.layerList),a=r.length,o=this.dataLayer;if(0===a)o.reset();else{s.isMix=!1,s.start=e.start,s.offset=e.offset;for(var h=0;a>h;++h)s.other=r[h],o.merge(s),s.isMix=!0}return e.isNotifyView===!0&&this.observer.notify(i.PIXELS_CHANGED_EVENT,e),this},e.replace=function(t){return this.activeLayer.replace(t),this.mergeLayers(t),this},e.set=function(t){return this.activeLayer.set(t),this.mergeLayers(t),this},e.setChannel=function(t){return this.activeLayer.setChannel(t),this.mergeLayers(t),this},e.fill=function(t){return this.activeLayer.fill(t),this.mergeLayers(t),this},e.indexAt=function(t){return(0|t.x)+(0|t.y)*this.getWidth()},e.positionFrom=function(t){var i=this.getWidth();return new pxl.Point(t%i,t/i|0)},e.getImageData=function(t){return t.start&&t.offset?this.dataLayer.generateImageData(t):this._imageData},e.getWidth=function(){return this._imageData.width},e.getHeight=function(){return this._imageData.height},e.getLayersCount=function(){return this.layerList.length},e.getVisibleLayers=function(){return t(this.layerList)},e.fixRange=function(t){var i=t.start,e=t.offset,n=this.getWidth(),s=this.getHeight();return i.x>=n||i.y>=s||e.x<=0||e.y<=0?!1:(i.x<0&&(e.x-=-i.x,i.x=0),i.y<0&&(e.y-=-i.y,i.y=0),i.x+e.x>n&&(e.x=n-i.x),i.y+e.y>s&&(e.y=s-i.y),!(e.x<=0||e.y<=0))},e.__process=function(t,i){if(t.start&&t.offset)for(var e=this.getWidth(),n=0|t.offset.y,s=0|t.offset.x,r=this.indexAt(t.start);n--;)i(r,r+s),r+=e;else i(0,this.dataLayer.data.length)},e.destroy=function(){this.dataLayer.destroy(),this._imageData=this.dataLayer=null,this.removeAllLayers()}}(),function(){"use strict";var t=pxl.Layout.Layer=function(i,e,n){if(this.data=new Uint32Array(i),this.data.length>t.MAX_BUFFER_SIZE/this.data.BYTES_PER_ELEMENT)throw this.data=null,new RangeError("Buffer limit has been reached!");this.name=n||"",this.isVisible=!0,this._layout=e||null,Object.seal(this)};t.MAX_BUFFER_SIZE=16777216;var i=t.prototype;i.reset=function(){this._fillLine(0,0,this.data.length)},i.copyFrom=function(t,i){this.data.set(t.data),i===!0&&(this.name=t.name,this._layout=t._layout,this.isVisible=t.isVisible)},i.merge=function(t){var i=this.data,e=t.other.data,n=pxl.RGBA.alphaBlend;t.isMix===!0?this._layout.__process(t,function(t,s){for(;s>t;)i[t]=n(i[t],e[t++])}):t.start&&t.offset?this._layout.__process(t,function(t,n){i.set(e.subarray(t,n),t)}):this.data.set(e)},i.replace=function(t){var i=this.data,e=t.pixel,n=t.oldPixel;this._layout.__process(t,function(t,s){for(;s>t;++t)i[t]===n&&(i[t]=e)})},i.set=function(t){var i=this,e=this.data,n=t.pixel,s=pxl.RGBA.alphaBlend;t.isMix===!0?this._layout.__process(t,function(t,i){for(;i>t;)e[t]=s(e[t++],n)}):this._layout.__process(t,function(t,e){i._fillLine(n,t,e)})},i.setChannel=function(t){var i=this.data,e=t.value,n=pxl.clamp(t.channelOffset,0,3);this._layout.__process(t,function(t,s){var r=new Uint8Array(i.subarray(t,s).buffer);for(s=r.length,t=n;s>t;t+=4)r[t]=e})},i.fill=function(t){var i=this._layout,e=this.data,n=0,s=0,r=i.getWidth(),a=e.length,o=t.pixel,h=i.indexAt(t.position);if(e[h]!==o){if(t.start&&t.offset){var u=new pxl.Point(t.start).add(t.offset).floor();if(t.position.x<t.start.x||t.position.y<t.start.y||t.position.x>u.x||t.position.y>u.y)return;s=0|t.start.x,r=0|t.offset.x,n=i.indexAt(t.start),a=i.indexAt(u)}if(!(n>h||h>=a)){var l=0,c=i.getWidth(),f=!1,y=!1,_=this.pixelFromIndex(h),d=e[h]=t.isMix===!0?pxl.RGBA.alphaBlend(e[h],o):o,g=0,p=0,x=0,v=0,m=0,b=[h];do{for(h=b.pop(),v=s+(h/c|0)*c,m=v+r,x=0;--h>=v&&e[h]===_;)++x;for(l=++h,f=y=!1;;)if(g=h-c,p=c+h++,g>n&&(e[g]===_?f===!1&&(b.push(g),f=!0):f=!1),a>p&&(e[p]===_?y===!1&&(b.push(p),y=!0):y=!1),0===x){if(h>=m||e[h]!==_)break}else--x;this._fillLine(d,l,h)}while(b.length)}}},i.insertData=function(t){var i=0,e=this.data,n=t.data.constructor===Uint32Array?t.data:new Uint32Array(t.data.buffer);this._layout.__process(t,function(t,s){e.set(n.subarray(i,i+=s-t),t)})},i.setAt=function(t,i){this.data[t]=i},i.pixelFromPosition=function(t){return this.pixelFromIndex(this._layout.indexAt(t))},i.pixelFromIndex=function(t){return this.data[t]},i.generateImageData=function(t){var i=this._layout,e=t.start&&t.offset?pxl.createImageData(t.offset.x,t.offset.y):pxl.createImageData(i.getWidth(),i.getHeight());return void this._generateData(new Uint32Array(e.data.buffer),this.data,t),e},i.cloneData=function(t){return this._generateData(null,this.data,t)},i.getLayout=function(){return this._layout},i._generateData=function(t,i,e){var n=0;return e.start&&e.offset?(t=t||new Uint32Array((0|e.offset.x)*(0|e.offset.y)),this._layout.__process(e,function(e,s){t.set(i.subarray(e,s),n),n+=s-e})):t?t.set(i):t=new Uint32Array(i),t},"fill"in Uint32Array.prototype?i._fillLine=function(t,i,e){this.data.fill(t,i,e)}:i._fillLine=function(t,i,e){for(var n=this.data;e>i;)n[i++]=t},"copyWithin"in Uint32Array.prototype?i._copyWithin=function(t,i,e){this.data.copyWithin(t,i,e)}:i._copyWithin=function(t,i,e){var n=this.data;for(e=e||n.length;e>i;)n[t++]=n[i++]},i._reverseLine=function(t,i){var e=this.data;if(0===arguments.length&&"reverse"in Uint32Array.prototype)e.reverse();else{var n=0;for(t=t||0,i=i||e.length;t<--i;){var n=e[i];e[i]=e[t],e[t++]=n}}},i.destroy=function(){this._layout=this.data=null,this.isVisible=!1}}(),function(){"use strict";pxl.Layout.history={Session:null,SessionDynamic:null,SessionStatic:null,STATIC_SHOT:1,DYNAMIC_SHOT:2,_stack:[],_pointer:0,_lastSession:null,_isRecording:!1,getHistorySize:function(){return this._stack.length},isRecording:function(){return this._isRecording},undo:function(){this._pointer>0&&this._stack[--this._pointer].rewrite()},redo:function(){this._pointer<this._stack.length&&this._stack[this._pointer++].rewrite()},cache:function(t){this._lastSession.cache(t)},record:function(t,i){if(this._isRecording===!0)throw new Error("Recording has been started before!");if(i===pxl.Layout.history.STATIC_SHOT)this._lastSession=new pxl.Layout.history.SessionStatic(t.activeLayer);else{if(i!==pxl.Layout.history.DYNAMIC_SHOT)throw new Error("Unknown flag!");this._lastSession=new pxl.Layout.history.SessionDynamic(t.activeLayer)}this._isRecording=!0},stop:function(t){if(this._isRecording===!1)throw this.resetRecording(),new Error("Recording has not been started!");this._lastSession.isEmpty()===!1&&(t===!0?(this._stack.push(this._lastSession),this._stack.shift()):(this._stack[this._pointer++]=this._lastSession,this._stack.splice(this._pointer,this._stack.length))),this.resetRecording()},resetRecording:function(){this._isRecording=!1,this._lastSession=null},free:function(){this._lastSession=null,this._stack.length=0,this._pointer=0},deleteLayer:function(t){for(var i=0,e=null,n=this._stack;i<n.length;)e=n[i],t!==e.layer?++i:(this._pointer>=i&&--this._pointer<0&&(this._pointer=0),n.splice(i,1))}},Object.seal(pxl.Layout.history)}(),function(){"use strict";var t=pxl.Layout.history.Session=function(t){this.layer=t},i=pxl.Layout.history.SessionDynamic=function(i){t.call(this,i),this._indexMap={},Object.seal(this)};pxl.extend(i,t);var e=i.prototype;e.isEmpty=function(){for(var t in this._indexMap)return!1;return!0},e.cache=function(t){function i(t){t in n==!1&&(n[t]=e[t])}var e=this.layer.data,n=this._indexMap;t.constructor===Number?i(t):this.layer.getLayout().__process(t,function(t,e){for(;e>t;)i(t++)})},e.rewrite=function(){var t={},i=this.layer.data,e=this._indexMap;for(var n in e)t[n]=i[n],i[n]=e[n];this._indexMap=t};var n=pxl.Layout.history.SessionStatic=function(i){t.call(this,i),this._cached=!1,this._cachedOption=null,this._layerOptions={name:i.name,isVisible:i.isVisible},Object.seal(this)};pxl.extend(n,t);var s=n.prototype;s.isEmpty=function(){return null===this._cachedOption},s.cache=function(t){if(this._cached===!0)throw new Error("Static sessions can be cached only once!");this._cached=!0,t.start&&t.offset?this._cachedOption={data:this.layer.cloneData(t),start:t.start.clone(),offset:t.offset.clone()}:this._cachedOption={data:this.layer.cloneData(t)}},s.rewrite=function(){var t=this._cachedOption,i=this.layer.cloneData(t);this.layer.insertData(t),t.data=i}}();