var pxl=function(t){"use strict";function e(t,e){"imageSmoothingEnabled"in t?t.imageSmoothingEnabled=e:"webkitImageSmoothingEnabled"in t?t.webkitImageSmoothingEnabled=e:"mozImageSmoothingEnabled"in t?t.mozImageSmoothingEnabled=e:"msImageSmoothingEnabled"in t&&(t.msImageSmoothingEnabled=e)}var i=void 0,n=!0,s=null,r={},a=null,o=null;try{if(Object.seal(r),a=t.createElement("CANVAS"),a.width=a.height=1,o=a.getContext("2d"),s=Object.getPrototypeOf(o.getImageData(0,0,1,1).data).constructor,s!==Uint8ClampedArray&&s!==Uint8Array)throw new Error;if(!(new s).buffer)throw new Error;i=2712847316===new Uint32Array(new Uint8Array([161,178,195,212]).buffer)[0]}catch(h){n=!1}var u={Layout:null,RGBA:null,View:null,Point:null,Observer:null,bresenham:null,controller:null,emptyOptions:r,ImageDataArray:s,isSupported:function(){return n},isBigEndian:function(){return i},createImageData:function(){return o.createImageData.apply(o,arguments)},clamp:function(t,e,i){return t>i?i:e>t?e:t},createCanvas:function(){return a.cloneNode()},imageDataFromImage:function(t){var e=null;return a.width=t.width,a.height=t.height,o.drawImage(t,0,0),e=o.getImageData(0,0,a.width,a.height),a.width=a.height=1,e},enableAntialiasing:function(t){e(t,!0)},disableAntialiasing:function(t){e(t,!1)},extend:function(t,e){var i=function(){};i.prototype=e.prototype,t.prototype=new i,t.prototype.constructor=t}};return Object.seal(u),u}(document);!function(t){"use strict";function e(t){var e=0|t;return e!==t&&0>e?--e:e}function i(t){return t+.5|0}function n(t){var e=0|t;return t===e?t:e+1}function s(t){return 0>t||t===-0?-t:t}if(t){var r=t.Point=function(t,e){this.set(t||0,e),Object.seal(this)};r.EPSILON=1e-10;var a=r.prototype;a.toString=function(){return'{"x":'+this.x+',"y":'+this.y+"}"},a.add=function(t,e){return t instanceof r?(this.x+=t.x,this.y+=t.y):(this.x+=t,this.y+="number"==typeof e?e:t),this},a.sub=function(t,e){return t instanceof r?(this.x-=t.x,this.y-=t.y):(this.x-=t,this.y-="number"==typeof e?e:t),this},a.mul=function(t,e){return t instanceof r?(this.x*=t.x,this.y*=t.y):(this.x*=t,this.y*="number"==typeof e?e:t),this},a.div=function(t,e){return t instanceof r?(this.x/=t.x,this.y/=t.y):(this.x/=t,this.y/="number"==typeof e?e:t),this},a.set=function(t,e){return t instanceof r?(this.x=t.x,this.y=t.y):(this.x=t,this.y="number"==typeof e?e:t),this},a.cmp=function(t,e){return t instanceof r?s(this.x-t.x)<r.EPSILON&&s(this.y-t.y)<r.EPSILON:s(this.x-t)<r.EPSILON&&s(this.y-("number"==typeof e?e:t))<r.EPSILON},a.abs=function(){return this.x=s(this.x),this.y=s(this.y),this},a.neg=function(){return this.x=-s(this.x),this.y=-s(this.y),this},a.swap=function(t){var e=t.x;return t.x=this.x,this.x=e,e=t.y,t.y=this.y,this.y=e,this},a.floor=function(){return this.x=e(this.x),this.y=e(this.y),this},a.ceil=function(){return this.x=n(this.x),this.y=n(this.y),this},a.round=function(){return this.x=i(this.x),this.y=i(this.y),this},a.hasNaN=function(){return isNaN(this.x)||isNaN(this.y)},a.hasInfinity=function(){return!isFinite(this.x)||!isFinite(this.y)},a.clone=function(){return new r(this)}}}(pxl),function(t){"use strict";if(t){var e="'method' is not a function!",i=t.Observer=function(){this._eventBook={},Object.seal(this)},n=i.prototype;n.subscribe=function(t,i){if(!(i instanceof Function))throw new Error(e);if(t in this._eventBook){var n=this._eventBook[t];-1===n.indexOf(i)&&n.push(i)}else this._eventBook[t]=[i]},n.unsubscribe=function(t,i){if(!(i instanceof Function))throw new Error(e);if(t in this._eventBook){var n=this._eventBook[t],s=n.indexOf(i);-1!==s&&(n.splice(s,1),0===n.length&&delete this._eventBook[t])}},n.notify=function(t,e){if(t in this._eventBook)for(var i=this._eventBook[t],n=0;n<i.length;++n)i[n](e)}}}(pxl),function(t){"use strict";if(t){var e=t.bresenham={line:function(t,e,i,n,s){var r=i-t;0>r&&(r=-r);var a=n-e;a>=0&&(a=-a);for(var o=i>t?1:-1,h=n>e?1:-1,u=r+a,l=0;s(t,e),t!==i||e!==n;)l=u+u,l>=a&&(u+=a,t+=o),r>=l&&(u+=r,e+=h)},rectangle:function(t,i,n,s,r){var a=0;t===n||i===s?t===n&&i===s?r(t,i):e.line(t,i,n,i,r):(t>n&&(a=t,t=n,n=a),i>s&&(a=i,i=s,s=a),e.line(t,i,n-1,i,r),e.line(n,i,n,s-1,r),e.line(n,s,t+1,s,r),e.line(t,s,t,i+1,r))},ellipse:function(t,e,i,n,s){var r=i-t,a=r*r;0>r&&(r=-r);var o=n-e,h=o*o;0>o&&(o=-o);var u=1&o,l=(1-r)*h<<2,c=(1+u)*a<<2,f=l+c+u*a,y=0;t>i&&(t=i,i+=r),e>n&&(e=n),e+=o+1>>1,n=e-u,r=a<<3,u=h<<3;do s(i,e),s(t,e),s(t,n),s(i,n),y=f<<1,c>=y&&(++e,--n,f+=c+=r),(y>=l||f<<1>c)&&(++t,--i,f+=l+=u);while(i>=t);for(;o>=e-n;)s(t-1,e),s(i+1,e++),s(t-1,n),s(i+1,n--)}};Object.freeze(e)}}(pxl),function(t,e){"use strict";function i(t){return 255&t}function n(t){return(65280&t)>>8}function s(t){return(16711680&t)>>16}function r(t){return(4278190080&t)>>>24}var a=null,o=null,h=null,u=null,l=null;t&&e.constructor===Boolean&&(e?(a=t.RGBA=function(t,e,i,n){return(n|i<<8|e<<16|t<<24)>>>0},o=a.getR=r,h=a.getG=s,u=a.getB=n,l=a.getA=i):(a=t.RGBA=function(t,e,i,n){return(t|e<<8|i<<16|n<<24)>>>0},o=a.getR=i,h=a.getG=n,u=a.getB=s,l=a.getA=r),a.alphaBlend=function(t,e){var i=l(e),n=(255-i)*l(t)+127,s=(i<<8)+n>>8;return n>>=8,a((i*o(e)+n*o(t)+127)/s|0,(i*h(e)+n*h(t)+127)/s|0,(i*u(e)+n*u(t)+127)/s|0,s)},Object.freeze(a))}(pxl,pxl.isBigEndian()),function(){"use strict";function t(t){t._buffer=t._layout=null}function e(t,e){return e*(1-t)>>1}var i=pxl.View=function(t,e,i,n){this._buffer=e,this._ctx=t,this._layoutOwner=Boolean(n),this._imagePoint=new pxl.Point,this._scale=1,this._layout=i,this._boundedRender=null,this._subscribe(),Object.seal(this)};i.create=function(t){var e=null,n=null,s=null,r=!0,a=null,o=null,h=null;return e="CANVAS"===t.element.nodeName.toUpperCase()?t.element:t.element.appendChild(pxl.createCanvas()),t.source?(n=t.source._buffer.canvas,s=t.source._layout,r=!1):(n=pxl.createCanvas(),n.width=t.layoutSize.width,n.height=t.layoutSize.height,s=new pxl.Layout(n.width,n.height)),o=e.getContext("2d"),h=n.getContext("2d"),pxl.disableAntialiasing(o),pxl.disableAntialiasing(h),a=new i(o,h,s,r),i.instances.push(a),a},i.instances=[],i.activeView=null;var n=i.prototype;n.render=function(t){return this.clear(t).update(t).redraw(t)},n.drawRect=function(t){var e=t.pixel,i=pxl.RGBA;return t.pixel.constructor===Number?this._ctx.fillStyle="rgba("+i.getR(e)+","+i.getG(e)+","+i.getB(e)+","+i.getA(e)/255+")":this._ctx.fillStyle="rgba("+e[0]+","+e[1]+","+e[2]+","+e[3]/255+")",this._ctx.fillRect(t.start.x+this._imagePoint.x,t.start.y+this._imagePoint.y,t.offset.x,t.offset.y),this},n.redraw=function(t){return t.start&&t.offset?this._ctx.drawImage(this._buffer.canvas,t.start.x,t.start.y,t.offset.x,t.offset.y,t.start.x+this._imagePoint.x,t.start.y+this._imagePoint.y,t.offset.x,t.offset.y):this._ctx.drawImage(this._buffer.canvas,this._imagePoint.x,this._imagePoint.y),this},n.clear=function(t){return t.start&&t.offset?this._ctx.clearRect(t.start.x+this._imagePoint.x,t.start.y+this._imagePoint.y,t.offset.x,t.offset.y):this._ctx.clearRect(0,0,this._ctx.canvas.width,this._ctx.canvas.height),this},n.update=function(t){return this._layoutOwner&&(t.start&&t.offset?this._buffer.putImageData(this._layout.getImageData(t),t.start.x,t.start.y,0,0,t.offset.x,t.offset.y):this._buffer.putImageData(this._layout.getImageData(t),0,0)),this},n.begin=function(){var t=this._scale,i=this._ctx;return i.save(),i.translate(e(t,this._ctx.canvas.width),e(t,this._ctx.canvas.height)),i.scale(t,t),this},n.end=function(){return this._ctx.restore(),this},n.getBufferContext=function(){return this._buffer},n.getScale=function(){return this._scale},n.getElement=function(){return this._ctx.canvas},n.getLayout=function(){return this._layout},n.getImagePoint=function(){return this._imagePoint},n.getScaleOffset=function(){return new pxl.Point(e(this._scale,this._ctx.canvas.width),e(this._scale,this._ctx.canvas.height))},n.setScale=function(t){return t>=1&&(this._scale=0|t),this},n.setLayout=function(t){var e=i.instances;this.deleteLayout(),this._layout=t,this._subscribe(),this._layoutOwner=!0;for(var n=0;n<e.length;++n)if(e[n]!==this&&t===e[n]._layout){this._layoutOwner=!1;break}return this},n.setImagePoint=function(t,e){return this._imagePoint.set(t,e)},n.setAlpha=function(t){return this._ctx.globalAlpha=t,this},n.fitToTransition=function(t){return t.sub(this.getScaleOffset()).div(this._scale).floor(),this},n.resizeElement=function(t,e){return this._ctx.canvas.style.width=t+"px",this._ctx.canvas.style.height=e+"px",this._ctx.canvas.width=t,this._ctx.canvas.height=e,pxl.disableAntialiasing(this._ctx),this},n.deleteLayout=function(){var e=i.instances;if(this._unsubscribe(),this._layoutOwner){for(var n=0;n<e.length;++n)this!==e[n]&&this._layout===e[n]._layout&&(e[n]._unsubscribe(),t(e[n]));this._layout.destroy(),t(this)}return this},n._subscribe=function(){if(null!==this._boundedRender)throw new Error("View instance is already subscribed!");return this._boundedRender=this.render.bind(this),this._layout.observer.subscribe(pxl.Layout.PIXELS_CHANGED_EVENT,this._boundedRender),this},n._unsubscribe=function(){return this._layout.observer.unsubscribe(pxl.Layout.PIXELS_CHANGED_EVENT,this._boundedRender),this._boundedRender=null,this},n.destroy=function(){var t=i.instances;this.deleteLayout();for(var e=0;e<t.length;++e)if(this===t[e]){t.splice(e,1);break}}}(),function(){"use strict";function t(t){for(var e=[],i=0;i<t.length;++i)t[i].isVisible===!0&&e.push(t[i]);return e}var e=pxl.Layout=function(){this._imageData=pxl.createImageData.apply(null,arguments),this.dataLayer=new pxl.Layout.Layer(this._imageData.data.buffer,this),this.layerList=[],this.activeLayer=null,this.observer=new pxl.Observer,Object.seal(this)};e.PIXELS_CHANGED_EVENT="pixelsChanged";var i=e.prototype;i.insertLayer=function(t){function i(){return new e.Layer(this.getWidth()*this.getHeight(),this)}var n=null;return arguments.length?t>=0&&t<=this.layerList.length&&(n=i.call(this),this.layerList.splice(t,0,n)):(n=i.call(this),this.layerList.push(n)),n},i.setActiveTo=function(t){return t>=0&&t<this.layerList.length&&(this.activeLayer=this.layerList[t]),this},i.removeAllLayers=function(){for(this.activeLayer=null;this.layerList.length;)this.layerList.pop().destroy();return this},i.deleteLayer=function(){for(var t=this.layerList,e=0;e<t.length;++e)if(t[e]===this.activeLayer){t.splice(e,1),this.activeLayer.destroy(),this.activeLayer=null;break}return this},i.mergeLayers=function(i,n){var s={},r=t(n||this.layerList),a=r.length,o=this.dataLayer;if(0===a)o.reset();else{s.start=i.start,s.offset=i.offset,s.isMix=!1;for(var h=0;a>h;++h)s.other=r[h],o.merge(s),s.isMix=!0}return i.isNotifyView===!0&&this.observer.notify(e.PIXELS_CHANGED_EVENT,i),this},i.replace=function(t){return this.activeLayer.replace(t),this.mergeLayers(t),this},i.set=function(t){return this.activeLayer.set(t),this.mergeLayers(t),this},i.setChannel=function(t){return this.activeLayer.setChannel(t),this.mergeLayers(t),this},i.fill=function(t){return this.activeLayer.fill(t),this.mergeLayers(t),this},i.indexAt=function(t){return(0|t.x)+(0|t.y)*this.getWidth()},i.positionFrom=function(t){var e=this.getWidth();return new pxl.Point(t%e,t/e|0)},i.getImageData=function(t){return t.start&&t.offset?this.dataLayer.generateImageData(t):this._imageData},i.getWidth=function(){return this._imageData.width},i.getHeight=function(){return this._imageData.height},i.getLayersCount=function(){return this.layerList.length},i.getVisibleLayers=function(){return t(this.layerList)},i.fixRange=function(t){var e=t.start,i=t.offset,n=this.getWidth(),s=this.getHeight();return e.x>=n||e.y>=s||i.x<=0||i.y<=0?!1:(e.x<0&&(i.x-=-e.x,e.x=0),e.y<0&&(i.y-=-e.y,e.y=0),e.x+i.x>n&&(i.x=n-e.x),e.y+i.y>s&&(i.y=s-e.y),!(i.x<=0||i.y<=0))},i.__process=function(t,e){if(t.start&&t.offset)for(var i=this.getWidth(),n=0|t.offset.y,s=0|t.offset.x,r=this.indexAt(t.start);n--;)e(r,r+s),r+=i;else e(0,this.dataLayer.data.length)},i.destroy=function(){this.dataLayer.destroy(),this._imageData=this.dataLayer=null,this.removeAllLayers()}}(),function(){"use strict";var t=pxl.Layout.Layer=function(e,i,n){if(this.data=new Uint32Array(e),this.data.length>t.MAX_BUFFER_SIZE/this.data.BYTES_PER_ELEMENT)throw this.data=null,new RangeError("Buffer limit has been reached!");this.name=n||"",this.isVisible=!0,this._layout=i||null,Object.seal(this)};t.MAX_BUFFER_SIZE=16777216;var e=t.prototype;e.reset=function(){this._fillLine(0,0,this.data.length)},e.copyFrom=function(t,e){this.data.set(t.data),e===!0&&(this.name=t.name,this._layout=t._layout,this.isVisible=t.isVisible)},e.merge=function(t){var e=this.data,i=t.other.data,n=pxl.RGBA.alphaBlend;t.isMix===!0?this._layout.__process(t,function(t,s){for(;s>t;)e[t]=n(e[t],i[t++])}):t.start&&t.offset?this._layout.__process(t,function(t,n){e.set(i.subarray(t,n),t)}):this.data.set(i)},e.replace=function(t){var e=this.data,i=t.pixel,n=t.oldPixel;this._layout.__process(t,function(t,s){for(;s>t;++t)e[t]===n&&(e[t]=i)})},e.set=function(t){var e=this,i=this.data,n=t.pixel,s=pxl.RGBA.alphaBlend;t.isMix===!0?this._layout.__process(t,function(t,e){for(;e>t;)i[t]=s(i[t++],n)}):this._layout.__process(t,function(t,i){e._fillLine(n,t,i)})},e.setChannel=function(t){var e=this.data,i=t.value,n=pxl.clamp(t.channelOffset,0,3);this._layout.__process(t,function(t,s){var r=new Uint8Array(e.subarray(t,s).buffer);for(s=r.length,t=n;s>t;t+=4)r[t]=i})},e.fill=function(t){var e=this._layout,i=this.data,n=0,s=0,r=0,a=i.length,o=t.pixel,h=e.indexAt(t.position);if(t.start&&t.offset&&(s=t.start.x,r=t.start.x+t.offset.x,n=e.indexAt(t.start),a=e.indexAt(new pxl.Point(t.start).add(t.offset))),!(n>h||h>=a||i[h]===o)){var u=0,l=e.getWidth(),c=(e.getHeight(),!1),f=!1,y=this.pixelFromIndex(h),_=i[h]=t.isMix===!0?pxl.RGBA.alphaBlend(i[h],o):o,d=0,g=0,x=0,p=0,v=0,b=[h];do{for(h=b.pop(),p=s+(h/l|0)*l,v=p+l-r,x=0;--h>=p&&i[h]===y;)++x;for(u=++h,c=f=!1;;)if(d=h-l,g=l+h++,d>n&&(i[d]===y?c===!1&&(b.push(d),c=!0):c=!1),a>g&&(i[g]===y?f===!1&&(b.push(g),f=!0):f=!1),0===x){if(h>=v||i[h]!==y)break}else--x;this._fillLine(_,u,h)}while(b.length)}},e.insertData=function(t){var e=0,i=this.data,n=t.data.constructor===Uint32Array?t.data:new Uint32Array(t.data.buffer);this._layout.__process(t,function(t,s){i.set(n.subarray(e,e+=s-t),t)})},e.setAt=function(t,e){this.data[t]=e},e.pixelFromPosition=function(t){return this.pixelFromIndex(this._layout.indexAt(t))},e.pixelFromIndex=function(t){return this.data[t]},e.generateImageData=function(t){var e=this._layout,i=t.start&&t.offset?pxl.createImageData(t.offset.x,t.offset.y):pxl.createImageData(e.getWidth(),e.getHeight());return void this._generateData(new Uint32Array(i.data.buffer),this.data,t),i},e.cloneData=function(t){return this._generateData(null,this.data,t)},e.getLayout=function(){return this._layout},e._generateData=function(t,e,i){var n=0;return i.start&&i.offset?(t=t||new Uint32Array((0|i.offset.x)*(0|i.offset.y)),this._layout.__process(i,function(i,s){t.set(e.subarray(i,s),n),n+=s-i})):t?t.set(e):t=new Uint32Array(e),t},"fill"in Uint32Array.prototype?e._fillLine=function(t,e,i){this.data.fill(t,e,i)}:e._fillLine=function(t,e,i){for(var n=this.data;i>e;)n[e++]=t},e._reverseLine=function(t,e){var i=this.data;if(0===arguments.length&&"reverse"in Uint32Array.prototype)i.reverse();else{var n=0;for(t=t||0,e=e||i.length;t<--e;){var n=i[e];i[e]=i[t],i[t++]=n}}},e.destroy=function(){this._layout=this.data=null,this.isVisible=!1}}(),function(){"use strict";pxl.Layout.history={Session:null,SessionDynamic:null,SessionStatic:null,STATIC_SHOT:1,DYNAMIC_SHOT:2,_stack:[],_pointer:0,_lastSession:null,_isRecording:!1,getHistorySize:function(){return this._stack.length},isRecording:function(){return this._isRecording},undo:function(){this._pointer>0&&this._stack[--this._pointer].rewrite()},redo:function(){this._pointer<this._stack.length&&this._stack[this._pointer++].rewrite()},cache:function(t){this._lastSession.cache(t)},record:function(t,e){if(this._isRecording===!0)throw new Error("Recording has been started before!");if(e===pxl.Layout.history.STATIC_SHOT)this._lastSession=new pxl.Layout.history.SessionStatic(t.activeLayer);else{if(e!==pxl.Layout.history.DYNAMIC_SHOT)throw new Error("Unknown flag!");this._lastSession=new pxl.Layout.history.SessionDynamic(t.activeLayer)}this._isRecording=!0},stop:function(t){if(this._isRecording===!1)throw this.resetRecording(),new Error("Recording has not been started!");this._lastSession.isEmpty()===!1&&(t===!0?(this._stack.push(this._lastSession),this._stack.shift()):(this._stack[this._pointer++]=this._lastSession,this._stack.splice(this._pointer,this._stack.length))),this.resetRecording()},resetRecording:function(){this._isRecording=!1,this._lastSession=null},free:function(){this._lastSession=null,this._stack.length=0,this._pointer=0},deleteLayer:function(t){for(var e=0,i=null,n=this._stack;e<n.length;)i=n[e],t!==i.layer?++e:(this._pointer>=e&&--this._pointer<0&&(this._pointer=0),n.splice(e,1))}},Object.seal(pxl.Layout.history)}(),function(){"use strict";var t=pxl.Layout.history.Session=function(t){this.layer=t},e=pxl.Layout.history.SessionDynamic=function(e){t.call(this,e),this._indexMap={},Object.seal(this)};pxl.extend(e,t);var i=e.prototype;i.isEmpty=function(){for(var t in this._indexMap)return!1;return!0},i.cache=function(t){function e(t){t in n==!1&&(n[t]=i[t])}var i=this.layer.data,n=this._indexMap;t.constructor===Number?e(t):this.layer.getLayout().__process(t,function(t,i){for(;i>t;)e(t++)})},i.rewrite=function(){var t={},e=this.layer.data,i=this._indexMap;for(var n in i)t[n]=e[n],e[n]=i[n];this._indexMap=t};var n=pxl.Layout.history.SessionStatic=function(e){t.call(this,e),this._cached=!1,this._cachedOption=null,Object.seal(this)};pxl.extend(n,t);var s=n.prototype;s.isEmpty=function(){return null===this._cachedOption},s.cache=function(t){if(this._cached===!0)throw new Error("Static sessions can be cached only once!");this._cached=!0,t.start&&t.offset?this._cachedOption={data:this.layer.cloneData(t),start:t.start.clone(),offset:t.offset.clone()}:this._cachedOption={data:this.layer.cloneData(t)}},s.rewrite=function(){var t=this._cachedOption,e=this.layer.cloneData(t);this.layer.insertData(t),t.data=e}}();